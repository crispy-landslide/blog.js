services:
  blog-app:
    build: ./app
    container_name: blog-app
    ports:
      - 3000:3000
    environment:
      - REACT_APP_CUSTOM_MESSAGE=This message was defined in the docker-compose.yml file!
    depends_on:
      - blog-api

  blog-api:
    build: ./api
    container_name: blog-api
    ports:
      - 3001:3001
    environment:
      - CUSTOM_MESSAGE=This custom API message was also defined in the docker-compose.yml file!
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=/run/secrets/db_pass
      - POSTGRES_DB=postgres
      - NODE_ENV=production
      - DB_CONTAINER=db-docker
    depends_on:
      - blog-db
    secrets:
      - db_pass

  blog-db:
    image: postgres:alpine
    container_name: blog-db
    environment:
      - POSTGRES_USER=postgres
      - POSTGRES_PASSWORD=/run/secrets/db_pass
      - POSTGRES_DB=postgres
      - POSTGRES_HOST=db
      - POSTGRES_PORT=5432
    # user: 1000:1000
    ports:
      - 5432:5432
    volumes:
      - ./db:/var/lib/postgresql/data
    secrets:
      - db_pass

secrets:
  db_pass:
    file: ./api/env/db_pass.txt
